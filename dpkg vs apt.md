## dpkg vs apt

dpkg와 apt는 설치파일을 설치하기 위한 우분투의 파일 설치 툴이다.
그렇다면 dpkg와 apt는 어떻게 다를까?
먼저 dpkg부터 알아보자.

### 1. dpkg

dpkg는 데비안 계열의 .deb 확장자를 가진 패키지를 설치할 수 있도록 도와주는 파일 설치 툴이라고 할 수 있다.
그럼 먼저 .deb 확장자를 가진 패키지의 구성을 보도록 하겠다.
데비안 패키지는 다음과 같은 이름 구성을 가지고 있다.

```dpkg
패키지이름_버전-개정번호_아키텍쳐.deb
```

1.  패키지이름은 말 그대로 패키지의 이름을 말한다.
    만약 mypackage라는 패키지가 있다고 한다면
    패키지 이름은 mypackage가 된다.
2.  버전도 말 그대로 패키지의 버전을 말한다.
    버전은 또 주버전.부버전.패치버전으로 나뉘는데
    주버전은 패키지의 틀이 바뀔 정도의 큰 변화가 있었을 때 숫자가 올라가고,
    부버전은 패키지의 자잘자잘한 변화가 있었을 때 숫자가 올라가며,
    패치버전은 패키지의 오류 같은 걸 고치는 등의 패치가 이루어졌을 때 숫자가 올라간다.
3.  개정번호도 개정번호를 말하는데 개정이 몇 번 되었는가를 확인하는 것이다.
4.  아키텍쳐는 어떤 CPU 아키텍쳐에서 돌아가도록 설정되어 있는지를 알려주는 것이다.
    아키텍쳐가 amd64라면 64비트를 베이스로한 운영체제에서만 돌아간다는 뜻이고
    i386이라면 32비트를 베이스로한 운영체제에서만 돌아간다는 뜻이며
    all은 둘 다 돌아간다는 뜻이다.

이렇게 데비안 패키지에 대해서 알아보았는데
다시 본론으로 돌아가자면 dpkg는 데비안 계열의 패키지를 설치하는데 사용된다고 했다.
그럼 예를 들어서 mysql-community-server를 설치해보자.
dpkg 명령어를 이용해서 mysql-community-server를 설치하는 방법은
외부에서 mysql-community-server가 설치되어 있는 저장소에 가서 다운로드 받아온 후
다음과 같은 명령어를 통해 패키지를 설치하면 된다.

```dpkg
dpkg -i mysql-community-server.deb
```

이렇게 mysql-community-server를 설치하려고 하면 오류가 발생하게 된다.
오류가 발생하는 이유는 mysql-community-server를 설치하기 위해서는
mysql-common, client와 같이 mysql-community-server 패키지가 의존하고 있는
다른 패키지를 먼저 설치해주어야 설치할 수 있기 때문이다.

만약 dpkg로 mysql-community-server 패키지를 설치하고자 한다면
의존성을 가지고 있는 다른 패키지를 먼저 설치한 후 mysql-community-server를 설치해야 한다.

### 2. apt

apt는 사실 dpkg에서 향상된 패키지 설치 툴이다.
apt는 apt-get과 apt-cache로 나누어지는데 현재 우분투 20버전에서는 apt로 통합하여 사용하고 있다.
하지만 apt-get과 apt-cache로 나누어서 사용하는 경우도 있다고 한다.

apt는 다음과 같은 명령어로 mysql-community-server를 설치할 수 있게 도와준다.

```apt
apt-get install mysql-server
```

이름이 왜 mysql-community-server가 아니라 mysql-server냐고 물을 수도 있다.
이것은 우분투 패키지 저장소에 mysql-community-server를 포함한 mysql-server 패키지로 합쳐서
저장되어 있기 때문이다.

apt는 내부적으로 다음과 같이 동작한다.

1.  /etc/apt/sources.list 파일에서 우분투 저장소의 URL 주소를 확인한다.
2.  우분투에서 설치와 관련된 패키지 목록을 우분투 패키지 저장소에 요청한다.
3.  설치와 관련된 패키지 목록만 다운로드하여 우분투에 보낸다.
4.  우분투에서는 설치할 패키지의 목록을 프롬프트 창에 띄워준다.
5.  Y/N을 선택하는 창에서 Y를 누르면 정상적으로 다운로드하고 N을 누르면 취소한다.
6.  Y를 누르면 자동으로 패키지를 설치한다.

이렇게 패키지를 설치하면서 나오는 로그들을 보면 모두 내부적으로 dpkg를 이용하여 설치하는 것을 볼 수 있다.
따라서 apt와 dpkg는 apt가 dpkg를 사용하는 관계라고 볼 수 있다.